<!--
  FILE: templates/login.html
  DESCRIPTION: Login page template (PowerDNS-Admin style) with light/dark theme toggle.
  AUTHOR: ALSYUNDAWY IT SOLUTION
  CREATED: 2023-01-01
  LAST_UPDATED: 2026-01-02
  NOTES:
    - Struktur form dan template Jinja2 dipertahankan.
    - Client-side JS performs minimal hygiene only; server MUST re-validate all inputs.
    - Inline CSS/JS are minified for performance; CSP nonce token is used for inline script tag.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Log in · {{ SITE_NAME }}</title>

  <!-- Security meta (prefer setting stronger headers server-side) -->
  <meta name="referrer" content="no-referrer-when-downgrade">

  <!-- Modern UI font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <meta http-equiv="refresh" content="{{ 60 * SETTING.get('session_timeout') }}">
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}">

  {% assets "css_login" -%}
    <link rel="stylesheet" href="{{ ASSET_URL }}">
  {%- endassets %}

  <style>
:root{--bg-1:#ffffff;--bg-2:#f7fbff;--glass-border:rgba(2,6,23,0.04);--muted:rgba(2,6,23,0.6);--accent-from:#06b6d4;--accent-to:#3b82f6;--radius:14px;color-scheme:light}
[data-theme="dark"]{--bg-1:#071120;--bg-2:#081428;--glass-border:rgba(255,255,255,0.04);--muted:rgba(255,255,255,0.68);--accent-from:#5eead4;--accent-to:#60a5fa;--radius:14px;color-scheme:dark}
*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial,-apple-system; -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;background:radial-gradient(800px 400px at 10% 10%,rgba(96,165,250,0.03),transparent),linear-gradient(180deg,var(--bg-1),var(--bg-2));color:var(--muted)}
.page{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:3.2rem 1.2rem;gap:1.125rem;transition:background .25s ease}
.site-header{display:flex;align-items:center;justify-content:center;padding:0.375rem 0}
.site-header img{height:72px;object-fit:contain}
.theme-toggle{position:fixed;right:16px;top:12px;z-index:60;display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;border-radius:10px;border:1px solid var(--glass-border);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 6px 18px rgba(2,6,23,0.06);cursor:pointer}
.theme-toggle:focus{outline:3px solid rgba(59,130,246,0.18)}
.card{width:100%;max-width:560px;padding:32px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid var(--glass-border);box-shadow:0 10px 50px rgba(2,6,23,0.06);backdrop-filter:blur(8px);display:flex;flex-direction:column;gap:16px;align-items:stretch;position:relative;overflow:hidden;min-width:260px}
.brand{display:flex;flex-direction:column;align-items:center;gap:6px;margin-bottom:4px}
.brand .title{font-weight:700;font-size:1.125rem;color:var(--muted);letter-spacing:0.2px}
.brand .subtitle{font-size:.9375rem;color:var(--muted);margin-top:2px}
form{display:block}
.field{margin-bottom:0.75rem}
.input{width:100%;padding:0.875rem 1rem;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.85);color:#04131a;font-size:0.9375rem;outline:none;box-sizing:border-box}
[data-theme="dark"] .input{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);color:#fff}
.input::placeholder{color:rgba(2,6,23,0.35)}
[data-theme="dark"] .input::placeholder{color:rgba(255,255,255,0.48)}
.row{display:flex;gap:12px;align-items:center}
.row .left{flex:0 0 auto}
.row .right{flex:1 1 auto;display:flex;justify-content:flex-end}
.remember{display:flex;align-items:center;gap:10px;color:var(--muted);font-weight:600}
.remember input{width:18px;height:18px;appearance:none;border-radius:4px;border:1px solid rgba(0,0,0,0.12);background:transparent;display:inline-block}
[data-theme="dark"] .remember input{border:1px solid rgba(255,255,255,0.12)}
.remember input:checked{background:linear-gradient(90deg,var(--accent-from),var(--accent-to));border:0}
.btn{padding:0.75rem 1.25rem;border-radius:12px;border:0;font-weight:700;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,var(--accent-from),var(--accent-to));color:#042027;box-shadow:0 8px 24px rgba(96,165,250,0.12)}
.cta{min-width:220px}
.helper{font-size:0.875rem;color:var(--muted);text-align:center;margin-top:6px}
.helper a{color:var(--accent-to);text-decoration:none;font-weight:600}
.footer{text-align:center;color:rgba(2,6,23,0.6);font-size:0.8125rem;margin-top:6px}
[data-theme="dark"] .footer{color:rgba(255,255,255,0.6)}
.footer a{color:rgba(96,165,250,0.95)}
.alert{padding:10px;border-radius:10px;background:rgba(255,60,60,0.06);border:1px solid rgba(255,60,60,0.12);color:#ffb4b4;font-weight:600}
.hp-field{position:absolute!important;left:-9999px!important;top:auto!important;width:1px!important;height:1px!important;overflow:hidden!important}
.input:focus{box-shadow:0 0 0 4px rgba(96,165,250,0.06);border-color:rgba(96,165,250,0.4)}
.btn-primary:focus{outline:3px solid rgba(96,165,250,0.12)}
.sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
@media (max-width:520px){.card{padding:20px;border-radius:12px}.site-header img{height:56px}.row{flex-direction:column;align-items:stretch}.row .right{justify-content:stretch}.cta{width:100%}}
@media (min-width:1600px){.card{max-width:720px;padding:40px;border-radius:20px}}
  </style>
</head>
<body>
  <div class="page" id="pageRoot">
    <header class="site-header" role="banner">
      {% set header_logo = SETTING.get('site_logo') if SETTING.get('site_logo') else 'logo.png' %}
      {% if header_logo.startswith('http') %}
        <a href="/" aria-label="Home"><img src="{{ header_logo }}" alt="{{ SITE_NAME }} logo"></a>
      {% else %}
        <a href="/" aria-label="Home"><img src="{{ url_for('static', filename='img/' ~ header_logo) }}" alt="{{ SITE_NAME }} logo"></a>
      {% endif %}
    </header>

    <!-- Theme toggle -->
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle color theme" title="Toggle color theme" type="button">
      <!-- Inline SVG icon (kept small to avoid external asset blocking) -->
      <svg id="themeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
        <path d="M12 3v2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <path d="M12 19v2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <path d="M4.22 4.22l1.42 1.42" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <path d="M18.36 18.36l1.42 1.42" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <path d="M1 12h2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <path d="M21 12h2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <path d="M4.22 19.78l1.42-1.42" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <path d="M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
        <circle cx="12" cy="12" r="3.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"/>
      </svg>
    </button>

    <main class="card" role="main" aria-labelledby="login-title">
      <div class="brand">
        <div id="login-title" class="title">{{ SETTING.get('site_name') or SITE_NAME }}</div>
        <div class="subtitle">Sign in to continue</div>
      </div>

      {% if error %}
        <div class="alert" role="alert" aria-live="polite">{{ error }}</div>
      {% endif %}

      {% if SETTING.get('ldap_enabled') or SETTING.get('local_db_enabled') %}
      <form id="loginForm" action="" method="post" novalidate autocomplete="off" accept-charset="UTF-8" aria-describedby="login-desc">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
        <div class="hp-field" aria-hidden="true">
          <label for="hp_name">Do not fill</label>
          <input id="hp_name" name="hp_name" type="text" autocomplete="off" tabindex="-1">
        </div>

        <div class="field">
          <label for="username" class="sr-only">Username</label>
          <input id="username" name="username" type="text" class="input" placeholder="Username" required autofocus maxlength="64" pattern="[A-Za-z0-9@._\\-]{1,64}" autocomplete="username" {% if username %}value="{{ username }}"{% endif %} aria-label="Username">
        </div>

        <div class="field">
          <label for="password" class="sr-only">Password</label>
          <input id="password" name="password" type="password" class="input" placeholder="Password" required maxlength="128" autocomplete="current-password" aria-label="Password">
        </div>

        {% if SETTING.get('otp_field_enabled') %}
        <div class="field">
          <input name="otptoken" type="text" class="input" placeholder="OTP token (if enabled)" autocomplete="one-time-code" aria-label="OTP Token" maxlength="12">
        </div>
        {% endif %}

        {% if SETTING.get('ldap_enabled') and SETTING.get('local_db_enabled') %}
        <div class="field">
          <select class="input" name="auth_method" aria-label="Authentication method">
            <option value="LOCAL">Local Authentication</option>
            <option value="LDAP" {% if SETTING.get('login_ldap_first') %}selected{% endif %}>LDAP Authentication</option>
          </select>
        </div>
        {% elif SETTING.get('ldap_enabled') and not SETTING.get('local_db_enabled') %}
          <input type="hidden" name="auth_method" value="LDAP">
        {% else %}
          <input type="hidden" name="auth_method" value="LOCAL">
        {% endif %}

        <div class="row" style="margin-top:6px">
          <div class="left">
            <label class="remember"><input type="checkbox" name="remember" id="remember"> Remember me</label>
          </div>

          <div class="right">
            <button type="submit" class="btn btn-primary cta" aria-label="Sign in">Sign In</button>
          </div>
        </div>
      </form>
      {% endif %}

      {% if SETTING.get('google_oauth_enabled') or SETTING.get('github_oauth_enabled') or SETTING.get('oidc_oauth_enabled') or SETTING.get('azure_oauth_enabled') %}
      <div style="margin-top:6px" id="login-desc">
        {% if SETTING.get('ldap_enabled') or SETTING.get('local_db_enabled') %}
          <div class="helper">— OR —</div>
        {% endif %}
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
          {% if SETTING.get('oidc_oauth_enabled') %}
            <a href="{{ url_for('index.oidc_login') }}" class="btn" style="border:1px solid var(--glass-border);background:transparent;color:var(--muted);padding:10px;border-radius:10px;text-decoration:none;text-align:center;">Sign in with OpenID Connect</a>
          {% endif %}
          {% if SETTING.get('github_oauth_enabled') %}
            <a href="{{ url_for('index.github_login') }}" class="btn" style="border:1px solid var(--glass-border);background:transparent;color:var(--muted);padding:10px;border-radius:10px;text-decoration:none;text-align:center;">Sign in with GitHub</a>
          {% endif %}
          {% if SETTING.get('google_oauth_enabled') %}
            <a href="{{ url_for('index.google_login') }}" class="btn" style="border:1px solid var(--glass-border);background:transparent;color:var(--muted);padding:10px;border-radius:10px;text-decoration:none;text-align:center;">Sign in with Google</a>
          {% endif %}
          {% if SETTING.get('azure_oauth_enabled') %}
            <a href="{{ url_for('index.azure_login') }}" class="btn" style="border:1px solid var(--glass-border);background:transparent;color:var(--muted);padding:10px;border-radius:10px;text-decoration:none;text-align:center;">Sign in with Microsoft</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      {% if saml_enabled %}
        <div style="text-align:center"><a href="{{ url_for('index.saml_login') }}" style="color:var(--accent-to);text-decoration:none;font-weight:600">SAML login</a></div>
      {% endif %}

      {% if SETTING.get('signup_enabled') %}
        <div class="helper">No account? <a href="{{ url_for('index.register') }}">Create an account</a></div>
      {% endif %}

      <div class="footer" role="contentinfo">
        Powered by <a href="https://github.com/alsyundawy/PowerDNS-Admin" target="_blank" rel="noopener noreferrer">PowerDNS-Admin</a>
        <span aria-hidden="true" style="opacity:0.6;margin:0 8px">|</span>
        Modified by <a href="https://alsyundawy.com" target="_blank" rel="noopener noreferrer">ALSYUNDAWY IT SOLUTION</a>
      </div>
    </main>
  </div>

  {% assets "js_login" -%}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
  {%- endassets %}

  <script nonce="{{ CSP_NONCE|default('') }}">
/*!minified-client-js*/(function(){var doc=window.document,ls=window.localStorage||null,root=doc.documentElement,pageRoot=doc.getElementById('pageRoot'),toggle=doc.getElementById('themeToggle'),icon=doc.getElementById('themeIcon');function applyTheme(t){if(!t) t='light';root.setAttribute('data-theme',t);if(pageRoot) pageRoot.style.transition='background .25s ease';if(ls) try{ls.setItem('site-theme',t)}catch(e){}updateIcon(t);}function readStored(){try{if(ls){var s=ls.getItem('site-theme');if(s) return s}}catch(e){}var mq=window.matchMedia&&window.matchMedia('(prefers-color-scheme:dark)');if(mq&&mq.matches) return 'dark';return 'light';}function updateIcon(t){if(!icon) return;var isDark=t==='dark';icon.innerHTML=isDark?'<path d=\"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z\" fill=\"currentColor\"/>':'<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6\"><path d=\"M12 3v2\"/><path d=\"M12 19v2\"/><path d=\"M4.22 4.22l1.42 1.42\"/><path d=\"M18.36 18.36l1.42 1.42\"/><path d=\"M1 12h2\"/><path d=\"M21 12h2\"/><path d=\"M4.22 19.78l1.42-1.42\"/><path d=\"M18.36 5.64l1.42-1.42\"/><circle cx=\"12\" cy=\"12\" r=\"3.5\"/></g>';}function toggleTheme(){var cur=root.getAttribute('data-theme')||'light';applyTheme(cur==='light'?'dark':'light')}if(toggle){toggle.addEventListener('click',function(e){e.preventDefault();toggleTheme();},false);toggle.addEventListener('keydown',function(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();toggleTheme()}});}applyTheme(readStored());/* form hygiene */var form=doc.getElementById('loginForm');if(form){form.addEventListener('submit',function(e){var hp=doc.getElementById('hp_name');if(hp&&hp.value&&hp.value.trim()!==''){e.preventDefault();alert('Invalid submission.');return;}var u=doc.getElementById('username'),p=doc.getElementById('password');if(u){u.value=u.value.trim().slice(0,64)}if(p){p.value=p.value.slice(0,128)}},{passive:false});}try{var u0=doc.getElementById('username');if(u0)try{u0.focus();u0.select()}catch(e){} }catch(e){};})();
  </script>
</body>
</html>
